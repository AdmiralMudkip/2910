<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Frantic Frigate</title>
    </head>
    <body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    
    <script>
        var context;
        
        window.onload = function() {
            var canvas = document.getElementById("canvas"); 
            context = canvas.getContext("2d");
            var img = document.getElementById("highscores"); 
            context.drawImage(img,0,0,1280,720); 
        }
        
        var i,j;
        var scores;
        var info;
        var data;

        // Get a number of top scores
        function getTopScores (ctx, callback, context) {
            
	     $.ajax({
                type: 'GET',
                dataType: 'json',
                url: 'https://highscore2910.herokuapp.com/scores/',
                success: function(data) {
                    scores = data;
                    
                    if (callback) callback();
		  },
		  error: function(xhr, msg) {
              console.error('AJAX error', xhr.status, msg);
                }
            });
            console.log("Highscores retrieved.");
            return scores;
        };
        
        // Post a score
        function postScore (ctx, name, time, callback) {
            console.log('Posting score', name, time);
            $.ajax({
                type: 'POST',
                url: 'https://highscore2910.herokuapp.com/scores/',
                data: {
                    name: name,
                    time: time,
                },
		  success: function(data) {
              console.log('Score posted', data);
              if (callback) callback();
          },
                error: function(xhr, msg) {
                    console.error('AJAX error', xhr.status, msg);
                }
	   });

        };
    
        getTopScores();
        //have to delay, because it takes a second to get the scores
        setTimeout(function(){timer(scores)}, 500);
            
        function timer(data) {
            //sorts by time
            var found = [];
            //for (var i = 1; i <= 10; i++) {
            //    var index = data.prototype.find("name : level1");
            //  console.log(index);
            //while (index != -1){
                //    found.push(index);
                //    index = array.indexOf(("name : level" + i), ++index);
                //}
            
            //data.sort(function(a,b) { return parseInt(a.time) - parseInt(b.time)});
            //data.sort(function(a,b) { return localeCompare(a.name) - localeCompare(b.name)});
            
            //sorts from 0 > 9
            data.sort(function(a,b) {
                return a.name.localeCompare(b.name);
            });
            1
            for (var i = 0; i < 10; i ++) {
                var string = i.toString();
                var level = "level";
                var print;
                var running = [[]];
                var running = data.filter(function (person) {return person.name == (level.concat(string))});
                console.log(running);
                running.sort(function(a,b) { return parseInt(b.time) - parseInt(a.time)});  
                console.log(running[0]);
                
                print = running[0][3];
                //console.log(print);
            }
        }
        
        
        //posting works!
        //postScore(context, 'POST', 30);
        
    </script>
    <canvas id="canvas" width="1280" height="720"></canvas>
    <img src = "images/scores1280.jpg" id="highscores" style="display:none">
    </body>
</html>